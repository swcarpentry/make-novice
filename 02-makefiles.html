<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Automation and Make: Makefiles</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav software"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Software Carpentry" src="assets/images/software-logo.svg"></div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/02-makefiles.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav software" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Software Carpentry" src="assets/images/software-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Automation and Make
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Automation and Make
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">FIXME</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Automation and Make
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 12%" class="percentage">
    12%
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: 12%" aria-valuenow="12" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/02-makefiles.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro.html">1. Introduction</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Makefiles
        </span>
      
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-variables.html">3. Automatic Variables</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-dependencies.html">4. Dependencies on Data and Code</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-patterns.html">5. Pattern Rules</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-variables.html">6. Variables</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-functions.html">7. Functions</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-self-doc.html">8. Self-Documenting Makefiles</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-conclusion.html">9. Conclusion</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="reference.html">FIXME</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-intro.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="03-variables.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-intro.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Introduction</a>
        <a class="chapter-link float-end" href="03-variables.html" rel="next">Next: Automatic Variables... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Makefiles</h1>
        <p> Last updated on 2023-04-24 | 
        
        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/02-makefiles.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I write a simple Makefile?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Recognize the key parts of a Makefile, rules, targets, dependencies
and actions.</li>
<li>Write a simple Makefile.</li>
<li>Run Make from the shell.</li>
<li>Explain when and why to mark targets as <code>.PHONY</code>.</li>
<li>Explain constraints on dependencies.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Create a file, called <code>Makefile</code>, with the following
content:</p>
<pre class="make"><code># Count words.
isles.dat : books/isles.txt
	python countwords.py books/isles.txt isles.dat</code></pre>
<p>This is a <a href="reference.html#build-file">build file</a>, which
for Make is called a <a href="reference.html#makefile">Makefile</a> - a
file executed by Make. Note how it resembles one of the lines from our
shell script.</p>
<p>Let us go through each line in turn:</p>
<ul><li>
<code>#</code> denotes a <em>comment</em>. Any text from
<code>#</code> to the end of the line is ignored by Make but could be
very helpful for anyone reading your Makefile.</li>
<li>
<code>isles.dat</code> is a <a href="reference.html#target">target</a>, a file to be created, or
built.</li>
<li>
<code>books/isles.txt</code> is a <a href="reference.html#dependency">dependency</a>, a file that is needed
to build or update the target. Targets can have zero or more
dependencies.</li>
<li>A colon, <code>:</code>, separates targets from dependencies.</li>
<li>
<code>python countwords.py books/isles.txt isles.dat</code> is an <a href="reference.html#action">action</a>, a command to run to build or
update the target using the dependencies. Targets can have zero or more
actions. These actions form a recipe to build the target from its
dependencies and are executed similarly to a shell script.</li>
<li>Actions are indented using a single TAB character, <em>not</em> 8
spaces. This is a legacy of Make’s 1970’s origins. If the difference
between spaces and a TAB character isn’t obvious in your editor, try
moving your cursor from one side of the TAB to the other. It should jump
four or more spaces.</li>
<li>Together, the target, dependencies, and actions form a <a href="reference.html#rule">rule</a>.</li>
</ul><p>Our rule above describes how to build the target
<code>isles.dat</code> using the action
<code>python countwords.py</code> and the dependency
<code>books/isles.txt</code>.</p>
<p>Information that was implicit in our shell script - that we are
generating a file called <code>isles.dat</code> and that creating this
file requires <code>books/isles.txt</code> - is now made explicit by
Make’s syntax.</p>
<p>Let’s first ensure we start from scratch and delete the
<code>.dat</code> and <code>.png</code> files we created earlier:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm <span class="pp">*</span>.dat <span class="pp">*</span>.png</span></code></pre>
</div>
<p>By default, Make looks for a Makefile, called <code>Makefile</code>,
and we can run Make as follows:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>By default, Make prints out the actions it executes:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat</code></pre>
</div>
<p>If we see,</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Makefile:3: *** missing separator.  Stop.</code></pre>
</div>
<p>then we have used a space instead of a TAB characters to indent one
of our actions.</p>
<p>Let’s see if we got what we expected.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">-5</span> isles.dat</span></code></pre>
</div>
<p>The first 5 lines of <code>isles.dat</code> should look exactly like
before.</p>
<div id="makefiles-do-not-have-to-be-called-makefile" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="makefiles-do-not-have-to-be-called-makefile" class="callout-inner">
<h3 class="callout-title">Makefiles Do Not Have to be Called
<code>Makefile</code><a class="anchor" aria-label="anchor" href="#makefiles-do-not-have-to-be-called-makefile"></a>
</h3>
<div class="callout-content">
<p>We don’t have to call our Makefile <code>Makefile</code>. However, if
we call it something else we need to tell Make where to find it. This we
can do using <code>-f</code> flag. For example, if our Makefile is named
<code>MyOtherMakefile</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make <span class="at">-f</span> MyOtherMakefile</span></code></pre>
</div>
<p>Sometimes, the suffix <code>.mk</code> will be used to identify
Makefiles that are not called <code>Makefile</code>
e.g. <code>install.mk</code>, <code>common.mk</code> etc.</p>
</div>
</div>
</div>
<p>When we re-run our Makefile, Make now informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>This is because our target, <code>isles.dat</code>, has now been
created, and Make will not create it again. To see how this works, let’s
pretend to update one of the text files. Rather than opening the file in
an editor, we can use the shell <code>touch</code> command to update its
timestamp (which would happen if we did edit the file):</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> touch books/isles.txt</span></code></pre>
</div>
<p>If we compare the timestamps of <code>books/isles.txt</code> and
<code>isles.dat</code>,</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> books/isles.txt isles.dat</span></code></pre>
</div>
<p>then we see that <code>isles.dat</code>, the target, is now older
than <code>books/isles.txt</code>, its dependency:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r--    1 mjj      Administ   323972 Jun 12 10:35 books/isles.txt
-rw-r--r--    1 mjj      Administ   182273 Jun 12 09:58 isles.dat</code></pre>
</div>
<p>If we run Make again,</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>then it recreates <code>isles.dat</code>:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat</code></pre>
</div>
<p>When it is asked to build a target, Make checks the ‘last
modification time’ of both the target and its dependencies. If any
dependency has been updated since the target, then the actions are
re-run to update the target. Using this approach, Make knows to only
rebuild the files that, either directly or indirectly, depend on the
file that changed. This is called an <a href="reference.html#incremental-build">incremental build</a>.</p>
<div id="makefiles-as-documentation" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="makefiles-as-documentation" class="callout-inner">
<h3 class="callout-title">Makefiles as Documentation<a class="anchor" aria-label="anchor" href="#makefiles-as-documentation"></a>
</h3>
<div class="callout-content">
<p>By explicitly recording the inputs to and outputs from steps in our
analysis and the dependencies between files, Makefiles act as a type of
documentation, reducing the number of things we have to remember.</p>
</div>
</div>
</div>
<p>Let’s add another rule to the end of <code>Makefile</code>:</p>
<pre class="make"><code>abyss.dat : books/abyss.txt
	python countwords.py books/abyss.txt abyss.dat</code></pre>
<p>If we run Make,</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>Nothing happens because Make attempts to build the first target it
finds in the Makefile, the <a href="reference.html#default-target">default target</a>, which is
<code>isles.dat</code> which is already up-to-date. We need to
explicitly tell Make we want to build <code>abyss.dat</code>:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make abyss.dat</span></code></pre>
</div>
<p>Now, we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/abyss.txt abyss.dat</code></pre>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout-inner">
<h3 class="callout-title">“Up to Date” Versus “Nothing to be Done”<a class="anchor" aria-label="anchor" href="#up-to-date-versus-nothing-to-be-done"></a>
</h3>
<div class="callout-content">
<p>If we ask Make to build a file that already exists and is up to date,
then Make informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>If we ask Make to build a file that exists but for which there is no
rule in our Makefile, then we get message like:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make countwords.py</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: Nothing to be done for `countwords.py'.</code></pre>
</div>
<p><code>up to date</code> means that the Makefile has a rule with one
or more actions whose target is the name of a file (or directory) and
the file is up to date.</p>
<p><code>Nothing to be done</code> means that the file exists but either
:</p>
<ul><li>the Makefile has no rule for it, or</li>
<li>the Makefile has a rule for it, but that rule has no actions</li>
</ul></div>
</div>
</div>
<p>We may want to remove all our data files so we can explicitly
recreate them all. We can introduce a new target, and associated rule,
to do this. We will call it <code>clean</code>, as this is a common name
for rules that delete auto-generated files, like our <code>.dat</code>
files:</p>
<pre class="make"><code><span><span class="va">clean</span> <span class="op">:</span></span>
<span>  <span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
<p>This is an example of a rule that has no dependencies.
<code>clean</code> has no dependencies on any <code>.dat</code> file as
it makes no sense to create these just to remove them. We just want to
remove the data files whether or not they exist. If we run Make and
specify this target,</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
</div>
<p>There is no actual thing built called <code>clean</code>. Rather, it
is a short-hand that we can use to execute a useful sequence of actions.
Such targets, though very useful, can lead to problems. For example, let
us recreate our data files, create a directory called
<code>clean</code>, then run Make:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make isles.dat abyss.dat</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir clean</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `clean' is up to date.</code></pre>
</div>
<p>Make finds a file (or directory) called <code>clean</code> and, as
its <code>clean</code> rule has no dependencies, assumes that
<code>clean</code> has been built and is up-to-date and so does not
execute the rule’s actions. As we are using <code>clean</code> as a
short-hand, we need to tell Make to always execute this rule if we run
<code>make clean</code>, by telling Make that this is a <a href="reference.html#phony-target">phony target</a>, that it does not
build anything. This we do by marking the target as
<code>.PHONY</code>:</p>
<pre class="make"><code><span><span class="va">.PHONY</span> <span class="op">:</span> <span class="va">clean</span></span>
<span><span class="va">clean</span> <span class="op">:</span></span>
<span>  <span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
<p>If we run Make,</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
</div>
<p>We can add a similar command to create all the data files. We can put
this at the top of our Makefile so that it is the <a href="reference.html#default-target">default target</a>, which is
executed by default if no target is given to the <code>make</code>
command:</p>
<pre class="make"><code>.PHONY : dats
dats : isles.dat abyss.dat</code></pre>
<p>This is an example of a rule that has dependencies that are targets
of other rules. When Make runs, it will check to see if the dependencies
exist and, if not, will see if rules are available that will create
these. If such rules exist it will invoke these first, otherwise Make
will raise an error.</p>
<div id="dependencies" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dependencies" class="callout-inner">
<h3 class="callout-title">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<div class="callout-content">
<p>The order of rebuilding dependencies is arbitrary. You should not
assume that they will be built in the order in which they are
listed.</p>
<p>Dependencies must form a directed acyclic graph. A target cannot
depend on a dependency which itself, or one of its dependencies, depends
on that target.</p>
</div>
</div>
</div>
<p>This rule (<code>dats</code>) is also an example of a rule that has
no actions. It is used purely to trigger the build of its dependencies,
if needed.</p>
<p>If we run,</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>then Make creates the data files:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat</code></pre>
</div>
<p>If we run <code>make dats</code> again, then Make will see that the
dependencies (<code>isles.dat</code> and <code>abyss.dat</code>) are
already up to date. Given the target <code>dats</code> has no actions,
there is <code>nothing to be done</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: Nothing to be done for `dats'.</code></pre>
</div>
<p>Our Makefile now looks like this:</p>
<pre class="make"><code># Count words.
.PHONY : dats
dats : isles.dat abyss.dat

isles.dat : books/isles.txt
	python countwords.py books/isles.txt isles.dat

abyss.dat : books/abyss.txt
	python countwords.py books/abyss.txt abyss.dat

.PHONY : clean
clean :
	rm -f *.dat</code></pre>
<p>The following figure shows a graph of the dependencies embodied
within our Makefile, involved in building the <code>dats</code>
target:</p>
<figure><img src="fig/02-makefile.png" title="Dependencies represented within the Makefile" alt="Dependencies represented within the Makefile" class="figure mx-auto d-block"></figure><div id="write-two-new-rules" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="write-two-new-rules" class="callout-inner">
<h3 class="callout-title">Write Two New Rules<a class="anchor" aria-label="anchor" href="#write-two-new-rules"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal"><li>Write a new rule for <code>last.dat</code>, created from
<code>books/last.txt</code>.</li>
<li>Update the <code>dats</code> rule with this target.</li>
<li>Write a new rule for <code>results.txt</code>, which creates the
summary table. The rule needs to:</li>
</ol><ul><li>Depend upon each of the three <code>.dat</code> files.</li>
<li>Invoke the action
<code>python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt</code>.</li>
</ul><ol start="4" style="list-style-type: decimal"><li>Put this rule at the top of the Makefile so that it is the default
target.</li>
<li>Update <code>clean</code> so that it removes
<code>results.txt</code>.</li>
</ol><p>The starting Makefile is <a href="files/code/02-makefile/Makefile">here</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>See <a href="files/code/02-makefile-challenge/Makefile">this file</a>
for a solution.</p>
</div>
</div>
</div>
</div>
<p>The following figure shows the dependencies embodied within our
Makefile, involved in building the <code>results.txt</code> target:</p>
<figure><img src="fig/02-makefile-challenge.png" title="results.txt dependencies represented within the Makefile" alt="results.txt dependencies represented within the Makefile" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use <code>#</code> for comments in Makefiles.</li>
<li>Write rules as <code>target: dependencies</code>.</li>
<li>Specify update actions in a tab-indented block under the rule.</li>
<li>Use <code>.PHONY</code> to mark targets that don’t correspond to
files.</li>
</ul></div>
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-intro.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="03-variables.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-intro.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Introduction</a>
        <a class="chapter-link float-end" href="03-variables.html" rel="next">Next: Automatic Variables... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/02-makefiles.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/swcarpentry/make-novice/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/swcarpentry/make-novice/" class="external-link">Source</a></p>
				<p><a href="https://github.com/swcarpentry/make-novice/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.12.5)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.5.3" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.17" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://swcarpentry.github.io/make-novice/02-makefiles.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Makefiles",
  "creativeWorkStatus": "active",
  "url": "https://swcarpentry.github.io/make-novice/02-makefiles.html",
  "identifier": "https://swcarpentry.github.io/make-novice/02-makefiles.html",
  "dateCreated": "2015-06-18",
  "dateModified": "2023-04-24",
  "datePublished": "2023-08-22"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

