<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Automation and Make: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav software"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="swc-logo" alt="Software Carpentry" src="../assets/images/software-logo.svg">
</div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav software" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Software Carpentry" src="../assets/images/software-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Automation and Make
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Automation and Make
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">FIXME</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Automation and Make
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-makefiles.html">2. Makefiles</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-variables.html">3. Automatic Variables</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-dependencies.html">4. Dependencies on Data and Code</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-patterns.html">5. Pattern Rules</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-variables.html">6. Variables</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-functions.html">7. Functions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-self-doc.html">8. Self-Documenting Makefiles</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-conclusion.html">9. Conclusion</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">FIXME</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-intro"><p>Content from <a href="01-intro.html">Introduction</a></p>
<hr>
<p>Last updated on 2023-04-25 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/01-intro.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make my results easier to reproduce?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what Make is for.</li>
<li>Explain why Make differs from shell scripts.</li>
<li>Name other popular build tools.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Let’s imagine that we’re interested in testing Zipf’s Law in some of
our favorite books.</p>
<div id="zipfs-law" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="zipfs-law" class="callout-inner">
<h3 class="callout-title">Zipf’s Law<a class="anchor" aria-label="anchor" href="#zipfs-law"></a>
</h3>
<div class="callout-content">
<p>The most frequently-occurring word occurs approximately twice as
often as the second most frequent word. This is <a href="https://en.wikipedia.org/wiki/Zipf%27s_law" class="external-link">Zipf’s Law</a>.</p>
</div>
</div>
</div>
<p>We’ve compiled our raw data i.e. the books we want to analyze and
have prepared several Python scripts that together make up our analysis
pipeline.</p>
<p>Let’s take quick look at one of the books using the command
<code>head books/isles.txt</code>.</p>
<p>Our directory has the Python scripts and data files we will be
working with:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>|- books
|  |- abyss.txt
|  |- isles.txt
|  |- last.txt
|  |- LICENSE_TEXTS.md
|  |- sierra.txt
|- plotcounts.py
|- countwords.py
|- testzipf.py</code></pre>
</div>
<p>The first step is to count the frequency of each word in a book. For
this purpose we will use a python script <code>countwords.py</code>
which takes two command line arguments. The first argument is the input
file (<code>books/isles.txt</code>) and the second is the output file
that is generated (here <code>isles.dat</code>) by processing the
input.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> python countwords.py books/isles.txt isles.dat</span></code></pre>
</div>
<p>Let’s take a quick peek at the result.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> head <span class="at">-5</span> isles.dat</span></code></pre>
</div>
<p>This shows us the top 5 lines in the output file:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the 3822 6.7371760973
of 2460 4.33632998414
and 1723 3.03719372466
to 1479 2.60708619778
a 1308 2.30565838181</code></pre>
</div>
<p>We can see that the file consists of one row per word. Each row shows
the word itself, the number of occurrences of that word, and the number
of occurrences as a percentage of the total number of words in the text
file.</p>
<p>We can do the same thing for a different book:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> python countwords.py books/abyss.txt abyss.dat</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> head <span class="at">-5</span> abyss.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the 4044 6.35449402891
and 2807 4.41074795726
of 1907 2.99654305468
a 1594 2.50471401634
to 1515 2.38057825267</code></pre>
</div>
<p>Let’s visualize the results. The script <code>plotcounts.py</code>
reads in a data file and plots the 10 most frequently occurring words as
a text-based bar plot:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat ascii</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>the   ########################################################################
of    ##############################################
and   ################################
to    ############################
a     #########################
in    ###################
is    #################
that  ############
by    ###########
it    ###########</code></pre>
</div>
<p><code>plotcounts.py</code> can also show the plot graphically:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat show</span></code></pre>
</div>
<p>Close the window to exit the plot.</p>
<p><code>plotcounts.py</code> can also create the plot as an image file
(e.g. a PNG file):</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> python plotcounts.py isles.dat isles.png</span></code></pre>
</div>
<p>Finally, let’s test Zipf’s law for these books:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> python testzipf.py abyss.dat isles.dat</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Book	First	Second	Ratio
abyss	4044	2807	1.44
isles	3822	2460	1.55</code></pre>
</div>
<p>So we’re not too far off from Zipf’s law.</p>
<p>Together these scripts implement a common workflow:</p>
<ol style="list-style-type: decimal">
<li>Read a data file.</li>
<li>Perform an analysis on this data file.</li>
<li>Write the analysis results to a new file.</li>
<li>Plot a graph of the analysis results.</li>
<li>Save the graph as an image, so we can put it in a paper.</li>
<li>Make a summary table of the analyses</li>
</ol>
<p>Running <code>countwords.py</code> and <code>plotcounts.py</code> at
the shell prompt, as we have been doing, is fine for one or two files.
If, however, we had 5 or 10 or 20 text files, or if the number of steps
in the pipeline were to expand, this could turn into a lot of work.
Plus, no one wants to sit and wait for a command to finish, even just
for 30 seconds.</p>
<p>The most common solution to the tedium of data processing is to write
a shell script that runs the whole pipeline from start to finish.</p>
<p>So to reproduce the tasks that we have just done we create a new file
named <code>run_pipeline.sh</code> in which we place the commands one by
one. Using a text editor of your choice (e.g. for nano use the command
<code>nano run_pipeline.sh</code>) copy and paste the following text and
save it.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># USAGE: bash run_pipeline.sh</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># to produce plots for isles and abyss</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># and the summary table for the Zipf's law tests</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">python</span> countwords.py books/isles.txt isles.dat</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="ex">python</span> countwords.py books/abyss.txt abyss.dat</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">python</span> plotcounts.py isles.dat isles.png</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="ex">python</span> plotcounts.py abyss.dat abyss.png</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co"># Generate summary table</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="ex">python</span> testzipf.py abyss.dat isles.dat <span class="op">&gt;</span> results.txt</span></code></pre>
</div>
<p>Run the script and check that the output is the same as before:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> bash run_pipeline.sh</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">$</span> cat results.txt</span></code></pre>
</div>
<p>This shell script solves several problems in computational
reproducibility:</p>
<ol style="list-style-type: decimal">
<li>It explicitly documents our pipeline, making communication with
colleagues (and our future selves) more efficient.</li>
<li>It allows us to type a single command,
<code>bash run_pipeline.sh</code>, to reproduce the full analysis.</li>
<li>It prevents us from <em>repeating</em> typos or mistakes. You might
not get it right the first time, but once you fix something it’ll stay
fixed.</li>
</ol>
<p>Despite these benefits it has a few shortcomings.</p>
<p>Let’s adjust the width of the bars in our plot produced by
<code>plotcounts.py</code>.</p>
<p>Edit <code>plotcounts.py</code> so that the bars are 0.8 units wide
instead of 1 unit. (Hint: replace <code>width = 1.0</code> with
<code>width = 0.8</code> in the definition of
<code>plot_word_counts</code>.)</p>
<p>Now we want to recreate our figures. We <em>could</em> just
<code>bash run_pipeline.sh</code> again. That would work, but it could
also be a big pain if counting words takes more than a few seconds. The
word counting routine hasn’t changed; we shouldn’t need to recreate
those files.</p>
<p>Alternatively, we could manually rerun the plotting for each
word-count file. (Experienced shell scripters can make this easier on
themselves using a for-loop.)</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">for</span> book <span class="kw">in</span> abyss isles<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    <span class="ex">python</span> plotcounts.py <span class="va">$book</span>.dat <span class="va">$book</span>.png</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="cf">done</span></span></code></pre>
</div>
<p>With this approach, however, we don’t get many of the benefits of
having a shell script in the first place.</p>
<p>Another popular option is to comment out a subset of the lines in
<code>run_pipeline.sh</code>:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># USAGE: bash run_pipeline.sh</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># to produce plots for isles and abyss</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># and the summary table for the Zipf's law tests.</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># These lines are commented out because they don't need to be rerun.</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#python countwords.py books/isles.txt isles.dat</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#python countwords.py books/abyss.txt abyss.dat</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="ex">python</span> plotcounts.py isles.dat isles.png</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="ex">python</span> plotcounts.py abyss.dat abyss.png</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co"># Generate summary table</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co"># This line is also commented out because it doesn't need to be rerun.</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#python testzipf.py abyss.dat isles.dat &gt; results.txt</span></span></code></pre>
</div>
<p>Then, we would run our modified shell script using
<code>bash run_pipeline.sh</code>.</p>
<p>But commenting out these lines, and subsequently uncommenting them,
can be a hassle and source of errors in complicated pipelines.</p>
<p>What we really want is an executable <em>description</em> of our
pipeline that allows software to do the tricky part for us: figuring out
what steps need to be rerun.</p>
<p>For our pipeline Make can execute the commands needed to run our
analysis and plot our results. Like shell scripts it allows us to
execute complex sequences of commands via a single shell command. Unlike
shell scripts it explicitly records the dependencies between files -
what files are needed to create what other files - and so can determine
when to recreate our data files or image files, if our text files
change. Make can be used for any commands that follow the general
pattern of processing files to create new files, for example:</p>
<ul>
<li>Run analysis scripts on raw data files to get data files that
summarize the raw data (e.g. creating files with word counts from book
text).</li>
<li>Run visualization scripts on data files to produce plots
(e.g. creating images of word counts).</li>
<li>Parse and combine text files and plots to create papers.</li>
<li>Compile source code into executable programs or libraries.</li>
</ul>
<p>There are now many build tools available, for example <a href="https://ant.apache.org/" class="external-link">Apache ANT</a>, <a href="https://pydoit.org/" class="external-link">doit</a>, and <a href="https://docs.microsoft.com/en-us/cpp/build/reference/nmake-reference" class="external-link">nmake</a>
for Windows. Which is best for you depends on your requirements,
intended usage, and operating system. However, they all share the same
fundamental concepts as Make.</p>
<p>Also, you might come across build generation scripts e.g. <a href="https://www.gnu.org/software/autoconf/autoconf.html" class="external-link">GNU
Autoconf</a> and <a href="https://www.cmake.org/" class="external-link">CMake</a>. Those tools
do not run the pipelines directly, but rather generate files for use
with the build tools.</p>
<div id="why-use-make-if-it-is-almost-40-years-old" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-use-make-if-it-is-almost-40-years-old" class="callout-inner">
<h3 class="callout-title">Why Use Make if it is Almost 40 Years Old?<a class="anchor" aria-label="anchor" href="#why-use-make-if-it-is-almost-40-years-old"></a>
</h3>
<div class="callout-content">
<p>Make development was started by Stuart Feldman in 1977 as a Bell Labs
summer intern. Since then it has been undergoing an active development
and several implementations are available. Since it solves a common
issue of workflow management, it remains in widespread use even
today.</p>
<p>Researchers working with legacy codes in C or FORTRAN, which are very
common in high-performance computing, will, very likely encounter
Make.</p>
<p>Researchers can use Make for implementing reproducible research
workflows, automating data analysis and visualisation (using Python or
R) and combining tables and plots with text to produce reports and
papers for publication.</p>
<p>Make’s fundamental concepts are common across build tools.</p>
</div>
</div>
</div>
<p><a href="https://www.gnu.org/software/make/" class="external-link">GNU Make</a> is a
free-libre, fast, <a href="https://www.gnu.org/software/make/#documentation" class="external-link">well-documented</a>,
and very popular Make implementation. From now on, we will focus on it,
and when we say Make, we mean GNU Make.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Make allows us to specify what depends on what and how to update
things that are out of date.</li>
</ul>
</div>
</div>
</div></section><section id="aio-02-makefiles"><p>Content from <a href="02-makefiles.html">Makefiles</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/02-makefiles.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 40 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I write a simple Makefile?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Recognize the key parts of a Makefile, rules, targets, dependencies
and actions.</li>
<li>Write a simple Makefile.</li>
<li>Run Make from the shell.</li>
<li>Explain when and why to mark targets as <code>.PHONY</code>.</li>
<li>Explain constraints on dependencies.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Create a file, called <code>Makefile</code>, with the following
content:</p>
<pre class="make"><code># Count words.
isles.dat : books/isles.txt
	python countwords.py books/isles.txt isles.dat</code></pre>
<p>This is a <a href="reference.html#build-file">build file</a>, which
for Make is called a <a href="reference.html#makefile">Makefile</a> - a
file executed by Make. Note how it resembles one of the lines from our
shell script.</p>
<p>Let us go through each line in turn:</p>
<ul>
<li>
<code>#</code> denotes a <em>comment</em>. Any text from
<code>#</code> to the end of the line is ignored by Make but could be
very helpful for anyone reading your Makefile.</li>
<li>
<code>isles.dat</code> is a <a href="reference.html#target">target</a>, a file to be created, or
built.</li>
<li>
<code>books/isles.txt</code> is a <a href="reference.html#dependency">dependency</a>, a file that is needed
to build or update the target. Targets can have zero or more
dependencies.</li>
<li>A colon, <code>:</code>, separates targets from dependencies.</li>
<li>
<code>python countwords.py books/isles.txt isles.dat</code> is an <a href="reference.html#action">action</a>, a command to run to build or
update the target using the dependencies. Targets can have zero or more
actions. These actions form a recipe to build the target from its
dependencies and are executed similarly to a shell script.</li>
<li>Actions are indented using a single TAB character, <em>not</em> 8
spaces. This is a legacy of Make’s 1970’s origins. If the difference
between spaces and a TAB character isn’t obvious in your editor, try
moving your cursor from one side of the TAB to the other. It should jump
four or more spaces.</li>
<li>Together, the target, dependencies, and actions form a <a href="reference.html#rule">rule</a>.</li>
</ul>
<p>Our rule above describes how to build the target
<code>isles.dat</code> using the action
<code>python countwords.py</code> and the dependency
<code>books/isles.txt</code>.</p>
<p>Information that was implicit in our shell script - that we are
generating a file called <code>isles.dat</code> and that creating this
file requires <code>books/isles.txt</code> - is now made explicit by
Make’s syntax.</p>
<p>Let’s first ensure we start from scratch and delete the
<code>.dat</code> and <code>.png</code> files we created earlier:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> rm <span class="pp">*</span>.dat <span class="pp">*</span>.png</span></code></pre>
</div>
<p>By default, Make looks for a Makefile, called <code>Makefile</code>,
and we can run Make as follows:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>By default, Make prints out the actions it executes:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat</code></pre>
</div>
<p>If we see,</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Makefile:3: *** missing separator.  Stop.</code></pre>
</div>
<p>then we have used a space instead of a TAB characters to indent one
of our actions.</p>
<p>Let’s see if we got what we expected.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">head</span> <span class="at">-5</span> isles.dat</span></code></pre>
</div>
<p>The first 5 lines of <code>isles.dat</code> should look exactly like
before.</p>
<div id="makefiles-do-not-have-to-be-called-makefile" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="makefiles-do-not-have-to-be-called-makefile" class="callout-inner">
<h3 class="callout-title">Makefiles Do Not Have to be Called
<code>Makefile</code><a class="anchor" aria-label="anchor" href="#makefiles-do-not-have-to-be-called-makefile"></a>
</h3>
<div class="callout-content">
<p>We don’t have to call our Makefile <code>Makefile</code>. However, if
we call it something else we need to tell Make where to find it. This we
can do using <code>-f</code> flag. For example, if our Makefile is named
<code>MyOtherMakefile</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> make <span class="at">-f</span> MyOtherMakefile</span></code></pre>
</div>
<p>Sometimes, the suffix <code>.mk</code> will be used to identify
Makefiles that are not called <code>Makefile</code>
e.g. <code>install.mk</code>, <code>common.mk</code> etc.</p>
</div>
</div>
</div>
<p>When we re-run our Makefile, Make now informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>This is because our target, <code>isles.dat</code>, has now been
created, and Make will not create it again. To see how this works, let’s
pretend to update one of the text files. Rather than opening the file in
an editor, we can use the shell <code>touch</code> command to update its
timestamp (which would happen if we did edit the file):</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> touch books/isles.txt</span></code></pre>
</div>
<p>If we compare the timestamps of <code>books/isles.txt</code> and
<code>isles.dat</code>,</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> books/isles.txt isles.dat</span></code></pre>
</div>
<p>then we see that <code>isles.dat</code>, the target, is now older
than <code>books/isles.txt</code>, its dependency:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r--    1 mjj      Administ   323972 Jun 12 10:35 books/isles.txt
-rw-r--r--    1 mjj      Administ   182273 Jun 12 09:58 isles.dat</code></pre>
</div>
<p>If we run Make again,</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>then it recreates <code>isles.dat</code>:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat</code></pre>
</div>
<p>When it is asked to build a target, Make checks the ‘last
modification time’ of both the target and its dependencies. If any
dependency has been updated since the target, then the actions are
re-run to update the target. Using this approach, Make knows to only
rebuild the files that, either directly or indirectly, depend on the
file that changed. This is called an <a href="reference.html#incremental-build">incremental build</a>.</p>
<div id="makefiles-as-documentation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="makefiles-as-documentation" class="callout-inner">
<h3 class="callout-title">Makefiles as Documentation<a class="anchor" aria-label="anchor" href="#makefiles-as-documentation"></a>
</h3>
<div class="callout-content">
<p>By explicitly recording the inputs to and outputs from steps in our
analysis and the dependencies between files, Makefiles act as a type of
documentation, reducing the number of things we have to remember.</p>
</div>
</div>
</div>
<p>Let’s add another rule to the end of <code>Makefile</code>:</p>
<pre class="make"><code>abyss.dat : books/abyss.txt
	python countwords.py books/abyss.txt abyss.dat</code></pre>
<p>If we run Make,</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> make</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>Nothing happens because Make attempts to build the first target it
finds in the Makefile, the <a href="reference.html#default-target">default target</a>, which is
<code>isles.dat</code> which is already up-to-date. We need to
explicitly tell Make we want to build <code>abyss.dat</code>:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> make abyss.dat</span></code></pre>
</div>
<p>Now, we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/abyss.txt abyss.dat</code></pre>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="up-to-date-versus-nothing-to-be-done" class="callout-inner">
<h3 class="callout-title">“Up to Date” Versus “Nothing to be Done”<a class="anchor" aria-label="anchor" href="#up-to-date-versus-nothing-to-be-done"></a>
</h3>
<div class="callout-content">
<p>If we ask Make to build a file that already exists and is up to date,
then Make informs us that:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `isles.dat' is up to date.</code></pre>
</div>
<p>If we ask Make to build a file that exists but for which there is no
rule in our Makefile, then we get message like:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> make countwords.py</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: Nothing to be done for `countwords.py'.</code></pre>
</div>
<p><code>up to date</code> means that the Makefile has a rule with one
or more actions whose target is the name of a file (or directory) and
the file is up to date.</p>
<p><code>Nothing to be done</code> means that the file exists but either
:</p>
<ul>
<li>the Makefile has no rule for it, or</li>
<li>the Makefile has a rule for it, but that rule has no actions</li>
</ul>
</div>
</div>
</div>
<p>We may want to remove all our data files so we can explicitly
recreate them all. We can introduce a new target, and associated rule,
to do this. We will call it <code>clean</code>, as this is a common name
for rules that delete auto-generated files, like our <code>.dat</code>
files:</p>
<pre class="make"><code><span><span class="va">clean</span> <span class="op">:</span></span>
<span>  <span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
<p>This is an example of a rule that has no dependencies.
<code>clean</code> has no dependencies on any <code>.dat</code> file as
it makes no sense to create these just to remove them. We just want to
remove the data files whether or not they exist. If we run Make and
specify this target,</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
</div>
<p>There is no actual thing built called <code>clean</code>. Rather, it
is a short-hand that we can use to execute a useful sequence of actions.
Such targets, though very useful, can lead to problems. For example, let
us recreate our data files, create a directory called
<code>clean</code>, then run Make:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">$</span> make isles.dat abyss.dat</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">$</span> mkdir clean</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: `clean' is up to date.</code></pre>
</div>
<p>Make finds a file (or directory) called <code>clean</code> and, as
its <code>clean</code> rule has no dependencies, assumes that
<code>clean</code> has been built and is up-to-date and so does not
execute the rule’s actions. As we are using <code>clean</code> as a
short-hand, we need to tell Make to always execute this rule if we run
<code>make clean</code>, by telling Make that this is a <a href="reference.html#phony-target">phony target</a>, that it does not
build anything. This we do by marking the target as
<code>.PHONY</code>:</p>
<pre class="make"><code><span><span class="va">.PHONY</span> <span class="op">:</span> <span class="va">clean</span></span>
<span><span class="va">clean</span> <span class="op">:</span></span>
<span>  <span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
<p>If we run Make,</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> make clean</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">rm</span> <span class="op">-</span><span class="va">f</span> <span class="op">*</span><span class="va">.dat</span></span></code></pre>
</div>
<p>We can add a similar command to create all the data files. We can put
this at the top of our Makefile so that it is the <a href="reference.html#default-target">default target</a>, which is
executed by default if no target is given to the <code>make</code>
command:</p>
<pre class="make"><code>.PHONY : dats
dats : isles.dat abyss.dat</code></pre>
<p>This is an example of a rule that has dependencies that are targets
of other rules. When Make runs, it will check to see if the dependencies
exist and, if not, will see if rules are available that will create
these. If such rules exist it will invoke these first, otherwise Make
will raise an error.</p>
<div id="dependencies" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dependencies" class="callout-inner">
<h3 class="callout-title">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<div class="callout-content">
<p>The order of rebuilding dependencies is arbitrary. You should not
assume that they will be built in the order in which they are
listed.</p>
<p>Dependencies must form a directed acyclic graph. A target cannot
depend on a dependency which itself, or one of its dependencies, depends
on that target.</p>
</div>
</div>
</div>
<p>This rule (<code>dats</code>) is also an example of a rule that has
no actions. It is used purely to trigger the build of its dependencies,
if needed.</p>
<p>If we run,</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>then Make creates the data files:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat</code></pre>
</div>
<p>If we run <code>make dats</code> again, then Make will see that the
dependencies (<code>isles.dat</code> and <code>abyss.dat</code>) are
already up to date. Given the target <code>dats</code> has no actions,
there is <code>nothing to be done</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>make: Nothing to be done for `dats'.</code></pre>
</div>
<p>Our Makefile now looks like this:</p>
<pre class="make"><code># Count words.
.PHONY : dats
dats : isles.dat abyss.dat

isles.dat : books/isles.txt
	python countwords.py books/isles.txt isles.dat

abyss.dat : books/abyss.txt
	python countwords.py books/abyss.txt abyss.dat

.PHONY : clean
clean :
	rm -f *.dat</code></pre>
<p>The following figure shows a graph of the dependencies embodied
within our Makefile, involved in building the <code>dats</code>
target:</p>
<figure><img src="../fig/02-makefile.png" title="Dependencies represented within the Makefile" alt="Dependencies represented within the Makefile" class="figure mx-auto d-block"></figure><div id="write-two-new-rules" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="write-two-new-rules" class="callout-inner">
<h3 class="callout-title">Write Two New Rules<a class="anchor" aria-label="anchor" href="#write-two-new-rules"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Write a new rule for <code>last.dat</code>, created from
<code>books/last.txt</code>.</li>
<li>Update the <code>dats</code> rule with this target.</li>
<li>Write a new rule for <code>results.txt</code>, which creates the
summary table. The rule needs to:</li>
</ol>
<ul>
<li>Depend upon each of the three <code>.dat</code> files.</li>
<li>Invoke the action
<code>python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt</code>.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Put this rule at the top of the Makefile so that it is the default
target.</li>
<li>Update <code>clean</code> so that it removes
<code>results.txt</code>.</li>
</ol>
<p>The starting Makefile is <a href="../files/code/02-makefile/Makefile">here</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>See <a href="../files/code/02-makefile-challenge/Makefile">this file</a>
for a solution.</p>
</div>
</div>
</div>
</div>
<p>The following figure shows the dependencies embodied within our
Makefile, involved in building the <code>results.txt</code> target:</p>
<figure><img src="../fig/02-makefile-challenge.png" title="results.txt dependencies represented within the Makefile" alt="results.txt dependencies represented within the Makefile" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>#</code> for comments in Makefiles.</li>
<li>Write rules as <code>target: dependencies</code>.</li>
<li>Specify update actions in a tab-indented block under the rule.</li>
<li>Use <code>.PHONY</code> to mark targets that don’t correspond to
files.</li>
</ul>
</div>
</div>
</div></section><section id="aio-03-variables"><p>Content from <a href="03-variables.html">Automatic Variables</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/03-variables.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I abbreviate the rules in my Makefiles?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use Make automatic variables to remove duplication in a
Makefile.</li>
<li>Explain why shell wildcards in dependencies can cause problems.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>After the exercise at the end of the previous episode, our Makefile
looked like this:</p>
<pre class="make"><code># Generate summary table.
results.txt : isles.dat abyss.dat last.dat
	python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt

# Count words.
.PHONY : dats
dats : isles.dat abyss.dat last.dat

isles.dat : books/isles.txt
	python countwords.py books/isles.txt isles.dat

abyss.dat : books/abyss.txt
	python countwords.py books/abyss.txt abyss.dat

last.dat : books/last.txt
	python countwords.py books/last.txt last.dat

.PHONY : clean
clean :
	rm -f *.dat
	rm -f results.txt</code></pre>
<p>Our Makefile has a lot of duplication. For example, the names of text
files and data files are repeated in many places throughout the
Makefile. Makefiles are a form of code and, in any code, repeated code
can lead to problems e.g. we rename a data file in one part of the
Makefile but forget to rename it elsewhere.</p>
<div id="d.r.y.-dont-repeat-yourself" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="d.r.y.-dont-repeat-yourself" class="callout-inner">
<h3 class="callout-title">D.R.Y. (Don’t Repeat Yourself)<a class="anchor" aria-label="anchor" href="#d.r.y.-dont-repeat-yourself"></a>
</h3>
<div class="callout-content">
<p>In many programming languages, the bulk of the language features are
there to allow the programmer to describe long-winded computational
routines as short, expressive, beautiful code. Features in Python or R
or Java, such as user-defined variables and functions are useful in part
because they mean we don’t have to write out (or think about) all of the
details over and over again. This good habit of writing things out only
once is known as the “Don’t Repeat Yourself” principle or D.R.Y.</p>
</div>
</div>
</div>
<p>Let us set about removing some of the repetition from our
Makefile.</p>
<p>In our <code>results.txt</code> rule we duplicate the data file names
and the name of the results file name:</p>
<pre class="make"><code>results.txt : isles.dat abyss.dat last.dat
	python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt</code></pre>
<p>Looking at the results file name first, we can replace it in the
action with <code>$@</code>:</p>
<pre class="make"><code>results.txt : isles.dat abyss.dat last.dat
	python testzipf.py abyss.dat isles.dat last.dat &gt; $@</code></pre>
<p><code>$@</code> is a Make <a href="reference.html#automatic-variable">automatic variable</a> which
means ‘the target of the current rule’. When Make is run it will replace
this variable with the target name.</p>
<p>We can replace the dependencies in the action with
<code>$^</code>:</p>
<pre class="make"><code>results.txt : isles.dat abyss.dat last.dat
	python testzipf.py $^ &gt; $@</code></pre>
<p><code>$^</code> is another automatic variable which means ‘all the
dependencies of the current rule’. Again, when Make is run it will
replace this variable with the dependencies.</p>
<p>Let’s update our text files and re-run our rule:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> touch books/<span class="pp">*</span>.txt</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat
python testzipf.py isles.dat abyss.dat last.dat &gt; results.txt</code></pre>
</div>
<div id="update-dependencies" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="update-dependencies" class="callout-inner">
<h3 class="callout-title">Update Dependencies<a class="anchor" aria-label="anchor" href="#update-dependencies"></a>
</h3>
<div class="callout-content">
<p>What will happen if you now execute:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> touch <span class="pp">*</span>.dat</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>nothing</li>
<li>all files recreated</li>
<li>only <code>.dat</code> files recreated</li>
<li>only <code>results.txt</code> recreated</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>4.</code> Only <code>results.txt</code> recreated.</p>
<p>The rules for <code>*.dat</code> are not executed because their
corresponding <code>.txt</code> files haven’t been modified.</p>
<p>If you run:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> touch books/<span class="pp">*</span>.txt</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>you will find that the <code>.dat</code> files as well as
<code>results.txt</code> are recreated.</p>
</div>
</div>
</div>
</div>
<p>As we saw, <code>$^</code> means ‘all the dependencies of the current
rule’. This works well for <code>results.txt</code> as its action treats
all the dependencies the same - as the input for the
<code>testzipf.py</code> script.</p>
<p>However, for some rules, we may want to treat the first dependency
differently. For example, our rules for <code>.dat</code> use their
first (and only) dependency specifically as the input file to
<code>countwords.py</code>. If we add additional dependencies (as we
will soon do) then we don’t want these being passed as input files to
<code>countwords.py</code> as it expects only one input file to be named
when it is invoked.</p>
<p>Make provides an automatic variable for this, <code>$&lt;</code>
which means ‘the first dependency of the current rule’.</p>
<div id="rewrite-.dat-rules-to-use-automatic-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rewrite-.dat-rules-to-use-automatic-variables" class="callout-inner">
<h3 class="callout-title">Rewrite <code>.dat</code> Rules to Use
Automatic Variables<a class="anchor" aria-label="anchor" href="#rewrite-.dat-rules-to-use-automatic-variables"></a>
</h3>
<div class="callout-content">
<p>Rewrite each <code>.dat</code> rule to use the automatic variables
<code>$@</code> (‘the target of the current rule’) and
<code>$&lt;</code> (‘the first dependency of the current rule’). <a href="../files/code/03-variables/Makefile">This file</a> contains the
Makefile immediately before the challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>See <a href="../files/code/03-variables-challenge/Makefile">this
file</a> for a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>$@</code> to refer to the target of the current rule.</li>
<li>Use <code>$^</code> to refer to the dependencies of the current
rule.</li>
<li>Use <code>$&lt;</code> to refer to the first dependency of the
current rule.</li>
</ul>
</div>
</div>
</div></section><section id="aio-04-dependencies"><p>Content from <a href="04-dependencies.html">Dependencies on Data and Code</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/04-dependencies.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I write a Makefile to update things when my scripts have
changed rather than my input files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Output files are a product not only of input files but of the
scripts or code that created the output files.</li>
<li>Recognize and avoid false dependencies.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Our Makefile now looks like this:</p>
<pre class="make"><code># Generate summary table.
results.txt : isles.dat abyss.dat last.dat
	python testzipf.py $^ &gt; $@

# Count words.
.PHONY : dats
dats : isles.dat abyss.dat last.dat

isles.dat : books/isles.txt
	python countwords.py $&lt; $@

abyss.dat : books/abyss.txt
	python countwords.py $&lt; $@

last.dat : books/last.txt
	python countwords.py $&lt; $@

.PHONY : clean
clean :
	rm -f *.dat
	rm -f results.txt</code></pre>
<p>Our data files are produced using not only the input text files but
also the script <code>countwords.py</code> that processes the text files
and creates the data files. A change to <code>countwords.py</code>
(e.g. adding a new column of summary data or removing an existing one)
results in changes to the <code>.dat</code> files it outputs. So, let’s
pretend to edit <code>countwords.py</code>, using <code>touch</code>,
and re-run Make:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> make dats</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> touch countwords.py</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>Nothing happens! Though we’ve updated <code>countwords.py</code> our
data files are not updated because our rules for creating
<code>.dat</code> files don’t record any dependencies on
<code>countwords.py</code>.</p>
<p>We need to add <code>countwords.py</code> as a dependency of each of
our data files also:</p>
<pre class="make"><code>isles.dat : books/isles.txt countwords.py
	python countwords.py $&lt; $@

abyss.dat : books/abyss.txt countwords.py
	python countwords.py $&lt; $@

last.dat : books/last.txt countwords.py
	python countwords.py $&lt; $@</code></pre>
<p>If we pretend to edit <code>countwords.py</code> and re-run Make,</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> touch countwords.py</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat</code></pre>
</div>
<div id="dry-run" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dry-run" class="callout-inner">
<h3 class="callout-title">Dry run<a class="anchor" aria-label="anchor" href="#dry-run"></a>
</h3>
<div class="callout-content">
<p><code>make</code> can show the commands it will execute without
actually running them if we pass the <code>-n</code> flag:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> touch countwords.py</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">$</span> make <span class="at">-n</span> dats</span></code></pre>
</div>
<p>This gives the same output to the screen as without the
<code>-n</code> flag, but the commands are not actually run. Using this
‘dry-run’ mode is a good way to check that you have set up your Makefile
properly before actually running the commands in it.</p>
</div>
</div>
</div>
<p>The following figure shows a graph of the dependencies, that are
involved in building the target <code>results.txt</code>. Notice the
recently added dependencies <code>countwords.py</code> and
<code>testzipf.py</code>. This is how the Makefile should look after
completing the rest of the exercises in this episode.</p>
<figure><img src="../fig/04-dependencies.png" title="results.txt dependencies after adding countwords.py and testzipf.py as dependencies" alt="results.txt dependencies after adding countwords.py and testzipf.py as dependencies" class="figure mx-auto d-block"></figure><div id="why-dont-the-.txt-files-depend-on-countwords.py" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-dont-the-.txt-files-depend-on-countwords.py" class="callout-inner">
<h3 class="callout-title">Why Don’t the <code>.txt</code> Files Depend
on <code>countwords.py</code>?<a class="anchor" aria-label="anchor" href="#why-dont-the-.txt-files-depend-on-countwords.py"></a>
</h3>
<div class="callout-content">
<p><code>.txt</code> files are input files and as such have no
dependencies. To make these depend on <code>countwords.py</code> would
introduce a <a href="reference.html#false-dependency">false
dependency</a> which is not desirable.</p>
</div>
</div>
</div>
<p>Intuitively, we should also add <code>countwords.py</code> as a
dependency for <code>results.txt</code>, because the final table should
be rebuilt if we remake the <code>.dat</code> files. However, it turns
out we don’t have to do that! Let’s see what happens to
<code>results.txt</code> when we update <code>countwords.py</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> touch countwords.py</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/abyss.txt abyss.dat
python countwords.py books/isles.txt isles.dat
python countwords.py books/last.txt last.dat
python testzipf.py abyss.dat isles.dat last.dat &gt; results.txt</code></pre>
</div>
<p>The whole pipeline is triggered, even the creation of the
<code>results.txt</code> file! To understand this, note that according
to the dependency figure, <code>results.txt</code> depends on the
<code>.dat</code> files. The update of <code>countwords.py</code>
triggers an update of the <code>*.dat</code> files. Thus,
<code>make</code> sees that the dependencies (the <code>.dat</code>
files) are newer than the target file (<code>results.txt</code>) and
thus it recreates <code>results.txt</code>. This is an example of the
power of <code>make</code>: updating a subset of the files in the
pipeline triggers rerunning the appropriate downstream steps.</p>
<div id="updating-one-input-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="updating-one-input-file" class="callout-inner">
<h3 class="callout-title">Updating One Input File<a class="anchor" aria-label="anchor" href="#updating-one-input-file"></a>
</h3>
<div class="callout-content">
<p>What will happen if you now execute:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> touch books/last.txt</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>only <code>last.dat</code> is recreated</li>
<li>all <code>.dat</code> files are recreated</li>
<li>only <code>last.dat</code> and <code>results.txt</code> are
recreated</li>
<li>all <code>.dat</code> and <code>results.txt</code> are
recreated</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><code>3.</code> only <code>last.dat</code> and
<code>results.txt</code> are recreated.</p>
<p>Follow the dependency tree to understand the answer(s).</p>
</div>
</div>
</div>
</div>
<div id="testzipf.py-as-a-dependency-of-results.txt." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="testzipf.py-as-a-dependency-of-results.txt." class="callout-inner">
<h3 class="callout-title">
<code>testzipf.py</code> as a Dependency of
<code>results.txt</code>.<a class="anchor" aria-label="anchor" href="#testzipf.py-as-a-dependency-of-results.txt."></a>
</h3>
<div class="callout-content">
<p>What would happen if you added <code>testzipf.py</code> as dependency
of <code>results.txt</code>, and why?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>If you change the rule for the <code>results.txt</code> file like
this:</p>
<pre class="make"><code>results.txt : isles.dat abyss.dat last.dat testzipf.py
        python testzipf.py $^ &gt; $@</code></pre>
<p><code>testzipf.py</code> becomes a part of <code>$^</code>, thus the
command becomes</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">python</span> testzipf.py abyss.dat isles.dat last.dat testzipf.py <span class="op">&gt;</span> results.txt</span></code></pre>
</div>
<p>This results in an error from <code>testzipf.py</code> as it tries to
parse the script as if it were a <code>.dat</code> file. Try this by
running:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>You’ll get</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>python testzipf.py abyss.dat isles.dat last.dat testzipf.py &gt; results.txt
Traceback (most recent call last):
  File "testzipf.py", line 19, in &lt;module&gt;
    counts = load_word_counts(input_file)
  File "path/to/testzipf.py", line 39, in load_word_counts
    counts.append((fields[0], int(fields[1]), float(fields[2])))
IndexError: list index out of range
make: *** [results.txt] Error 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We still have to add the <code>testzipf.py</code> script as
dependency to <code>results.txt</code>. Given the answer to the
challenge above, we need to make a couple of small changes so that we
can still use automatic variables.</p>
<p>We’ll move <code>testzipf.py</code> to be the first dependency and
then edit the action so that we pass all the dependencies as arguments
to python using <code>$^</code>.</p>
<pre class="make"><code>results.txt : testzipf.py isles.dat abyss.dat last.dat
	python $^ &gt; $@</code></pre>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are<a class="anchor" aria-label="anchor" href="#where-we-are"></a>
</h3>
<div class="callout-content">
<p><a href="../files/code/04-dependencies/Makefile">This Makefile</a>
contains everything done so far in this topic.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Make results depend on processing scripts as well as data
files.</li>
<li>Dependencies are transitive: if A depends on B and B depends on C, a
change to C will indirectly trigger an update to A.</li>
</ul>
</div>
</div>
</div></section><section id="aio-05-patterns"><p>Content from <a href="05-patterns.html">Pattern Rules</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/05-patterns.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I define rules to operate on similar files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write Make pattern rules.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Our Makefile still has repeated content. The rules for each
<code>.dat</code> file are identical apart from the text and data file
names. We can replace these rules with a single <a href="reference.html#pattern-rule">pattern rule</a> which can be used to
build any <code>.dat</code> file from a <code>.txt</code> file in
<code>books/</code>:</p>
<pre class="make"><code>%.dat : countwords.py books/%.txt
	python $^ $@</code></pre>
<p><code>%</code> is a Make <a href="reference.html#wildcard">wildcard</a>, matching any number of any
characters.</p>
<p>This rule can be interpreted as: “In order to build a file named
<code>[something].dat</code> (the target) find a file named
<code>books/[that same something].txt</code> (one of the dependencies)
and run <code>python [the dependencies] [the target]</code>.”</p>
<p>If we re-run Make,</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> make clean</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/isles.txt isles.dat
python countwords.py books/abyss.txt abyss.dat
python countwords.py books/last.txt last.dat</code></pre>
</div>
<p>Note that we can still use Make to build individual <code>.dat</code>
targets as before, and that our new rule will work no matter what stem
is being matched.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> make sierra.dat</span></code></pre>
</div>
<p>which gives the output below:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/sierra.txt sierra.dat</code></pre>
</div>
<div id="using-make-wildcards" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="using-make-wildcards" class="callout-inner">
<h3 class="callout-title">Using Make Wildcards<a class="anchor" aria-label="anchor" href="#using-make-wildcards"></a>
</h3>
<div class="callout-content">
<p>The Make <code>%</code> wildcard can only be used in a target and in
its dependencies. It cannot be used in actions. In actions, you may
however use <code>$*</code>, which will be replaced by the stem with
which the rule matched.</p>
</div>
</div>
</div>
<p>Our Makefile is now much shorter and cleaner:</p>
<pre class="make"><code># Generate summary table.
results.txt : testzipf.py isles.dat abyss.dat last.dat
	python $^ &gt; $@

# Count words.
.PHONY : dats
dats : isles.dat abyss.dat last.dat

%.dat : countwords.py books/%.txt
	python $^ $@

.PHONY : clean
clean :
	rm -f *.dat
	rm -f results.txt</code></pre>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are<a class="anchor" aria-label="anchor" href="#where-we-are"></a>
</h3>
<div class="callout-content">
<p><a href="../files/code/05-patterns/Makefile">This Makefile</a> contains
all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the wildcard <code>%</code> as a placeholder in targets and
dependencies.</li>
<li>Use the special variable <code>$*</code> to refer to matching sets
of files in actions.</li>
</ul>
</div>
</div>
</div></section><section id="aio-06-variables"><p>Content from <a href="06-variables.html">Variables</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/06-variables.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I eliminate redundancy in my Makefiles?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use variables in a Makefile.</li>
<li>Explain the benefits of decoupling configuration from
computation.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Despite our efforts, our Makefile still has repeated content, i.e.
the name of our script – <code>countwords.py</code>, and the program we
use to run it – <code>python</code>. If we renamed our script we’d have
to update our Makefile in multiple places.</p>
<p>We can introduce a Make <a href="reference.html#variable">variable</a> (called a <a href="reference.html#macro">macro</a> in some versions of Make) to hold
our script name:</p>
<pre class="make"><code><span><span class="va">COUNT_SRC</span><span class="op">=</span><span class="va">countwords.py</span></span></code></pre>
<p>This is a variable <a href="reference.html#assignment">assignment</a>
- <code>COUNT_SRC</code> is assigned the value
<code>countwords.py</code>.</p>
<p>We can do the same thing with the interpreter language used to run
the script:</p>
<pre class="make"><code><span><span class="va">LANGUAGE</span><span class="op">=</span><span class="va">python</span></span></code></pre>
<p><code>$(...)</code> tells Make to replace a variable with its value
when Make is run. This is a variable <a href="reference.html#reference">reference</a>. At any place where we
want to use the value of a variable we have to write it, or reference
it, in this way.</p>
<p>Here we reference the variables <code>LANGUAGE</code> and
<code>COUNT_SRC</code>. This tells Make to replace the variable
<code>LANGUAGE</code> with its value <code>python</code>, and to replace
the variable <code>COUNT_SRC</code> with its value
<code>countwords.py</code>.</p>
<p>Defining the variable <code>LANGUAGE</code> in this way avoids
repeating <code>python</code> in our Makefile, and allows us to easily
change how our script is run (e.g. we might want to use a different
version of Python and need to change <code>python</code> to
<code>python2</code> – or we might want to rewrite the script using
another language (e.g. switch from Python to R)).</p>
<div id="use-variables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="use-variables" class="callout-inner">
<h3 class="callout-title">Use Variables<a class="anchor" aria-label="anchor" href="#use-variables"></a>
</h3>
<div class="callout-content">
<p>Update <code>Makefile</code> so that the <code>%.dat</code> rule
references the variable <code>COUNT_SRC</code>. Then do the same for the
<code>testzipf.py</code> script and the <code>results.txt</code> rule,
using <code>ZIPF_SRC</code> as the variable name.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><a href="../files/code/06-variables-challenge/Makefile">This
Makefile</a> contains a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<p>We place variables at the top of a Makefile so they are easy to find
and modify. Alternatively, we can pull them out into a new file that
just holds variable definitions (i.e. delete them from the original
Makefile). Let us create <code>config.mk</code>:</p>
<pre class="make"><code><span><span class="co"># Count words script.</span></span>
<span><span class="va">LANGUAGE</span><span class="op">=</span><span class="va">python</span></span>
<span><span class="va">COUNT_SRC</span><span class="op">=</span><span class="va">countwords.py</span></span>
<span></span>
<span><span class="co"># Test Zipf's rule</span></span>
<span><span class="va">ZIPF_SRC</span><span class="op">=</span><span class="va">testzipf.py</span></span></code></pre>
<p>We can then import <code>config.mk</code> into <code>Makefile</code>
using:</p>
<pre class="make"><code>include config.mk</code></pre>
<p>We can re-run Make to see that everything still works:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> make clean</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">$</span> make dats</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>We have separated the configuration of our Makefile from its rules –
the parts that do all the work. If we want to change our script name or
how it is executed we just need to edit our configuration file, not our
source code in <code>Makefile</code>. Decoupling code from configuration
in this way is good programming practice, as it promotes more modular,
flexible and reusable code.</p>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are<a class="anchor" aria-label="anchor" href="#where-we-are"></a>
</h3>
<div class="callout-content">
<p><a href="../files/code/06-variables/Makefile">This Makefile</a> and <a href="../files/code/06-variables/config.mk">its accompanying
<code>config.mk</code></a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Define variables by assigning values to names.</li>
<li>Reference variables using <code>$(...)</code>.</li>
</ul>
</div>
</div>
</div></section><section id="aio-07-functions"><p>Content from <a href="07-functions.html">Functions</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/07-functions.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 25 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How <em>else</em> can I eliminate redundancy in my Makefiles?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write Makefiles that use functions to match and transform sets of
files.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>At this point, we have the following Makefile:</p>
<pre class="make"><code>include config.mk

# Generate summary table.
results.txt : $(ZIPF_SRC) isles.dat abyss.dat last.dat
	$(LANGUAGE) $^ &gt; $@

# Count words.
.PHONY : dats
dats : isles.dat abyss.dat last.dat

%.dat : $(COUNT_SRC) books/%.txt
	$(LANGUAGE) $^ $@

.PHONY : clean
clean :
	rm -f *.dat
	rm -f results.txt</code></pre>
<p>Make has many <a href="reference.html#function">functions</a> which
can be used to write more complex rules. One example is
<code>wildcard</code>. <code>wildcard</code> gets a list of files
matching some pattern, which we can then save in a variable. So, for
example, we can get a list of all our text files (files ending in
<code>.txt</code>) and save these in a variable by adding this at the
beginning of our makefile:</p>
<pre class="make"><code>TXT_FILES=$(wildcard books/*.txt)</code></pre>
<p>We can add a <code>.PHONY</code> target and rule to show the
variable’s value:</p>
<pre class="make"><code>.PHONY : variables
variables:
	@echo TXT_FILES: $(TXT_FILES)</code></pre>
<div id="echo" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="echo" class="callout-inner">
<h3 class="callout-title">
<span class="citation">@echo</span><a class="anchor" aria-label="anchor" href="#echo"></a>
</h3>
<div class="callout-content">
<p>Make prints actions as it executes them. Using <code>@</code> at the
start of an action tells Make not to print this action. So, by using
<code>@echo</code> instead of <code>echo</code>, we can see the result
of <code>echo</code> (the variable’s value being printed) but not the
<code>echo</code> command itself.</p>
</div>
</div>
</div>
<p>If we run Make:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> make variables</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TXT_FILES: books/abyss.txt books/isles.txt books/last.txt books/sierra.txt</code></pre>
</div>
<p>Note how <code>sierra.txt</code> is now included too.</p>
<p><code>patsubst</code> (‘pattern substitution’) takes a pattern, a
replacement string and a list of names in that order; each name in the
list that matches the pattern is replaced by the replacement string.
Again, we can save the result in a variable. So, for example, we can
rewrite our list of text files into a list of data files (files ending
in <code>.dat</code>) and save these in a variable:</p>
<pre class="make"><code>DAT_FILES=$(patsubst books/%.txt, %.dat, $(TXT_FILES))</code></pre>
<p>We can extend <code>variables</code> to show the value of
<code>DAT_FILES</code> too:</p>
<pre class="make"><code>.PHONY : variables
variables:
	@echo TXT_FILES: $(TXT_FILES)
	@echo DAT_FILES: $(DAT_FILES)</code></pre>
<p>If we run Make,</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> make variables</span></code></pre>
</div>
<p>then we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TXT_FILES: books/abyss.txt books/isles.txt books/last.txt books/sierra.txt
DAT_FILES: abyss.dat isles.dat last.dat sierra.dat</code></pre>
</div>
<p>Now, <code>sierra.txt</code> is processed too.</p>
<p>With these we can rewrite <code>clean</code> and
<code>dats</code>:</p>
<pre class="make"><code>.PHONY : dats
dats : $(DAT_FILES)

.PHONY : clean
clean :
	rm -f $(DAT_FILES)
	rm -f results.txt</code></pre>
<p>Let’s check:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> make clean</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">$</span> make dats</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/abyss.txt abyss.dat
python countwords.py books/isles.txt isles.dat
python countwords.py books/last.txt last.dat
python countwords.py books/sierra.txt sierra.dat</code></pre>
</div>
<p>We can also rewrite <code>results.txt</code>:</p>
<pre class="make"><code>results.txt : $(ZIPF_SRC) $(DAT_FILES)
	$(LANGUAGE) $^ &gt; $@</code></pre>
<p>If we re-run Make:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> make clean</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="ex">$</span> make results.txt</span></code></pre>
</div>
<p>We get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>python countwords.py books/abyss.txt abyss.dat
python countwords.py books/isles.txt isles.dat
python countwords.py books/last.txt last.dat
python countwords.py books/sierra.txt sierra.dat
python testzipf.py  last.dat  isles.dat  abyss.dat  sierra.dat &gt; results.txt</code></pre>
</div>
<p>Let’s check the <code>results.txt</code> file:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> cat results.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Book	First	Second	Ratio
abyss	4044	2807	1.44
isles	3822	2460	1.55
last	12244	5566	2.20
sierra	4242	2469	1.72</code></pre>
</div>
<p>So the range of the ratios of occurrences of the two most frequent
words in our books is indeed around 2, as predicted by Zipf’s Law, i.e.,
the most frequently-occurring word occurs approximately twice as often
as the second most frequent word. Here is our final Makefile:</p>
<pre class="make"><code>include config.mk

TXT_FILES=$(wildcard books/*.txt)
DAT_FILES=$(patsubst books/%.txt, %.dat, $(TXT_FILES))

# Generate summary table.
results.txt : $(ZIPF_SRC) $(DAT_FILES)
	$(LANGUAGE) S^ &gt; $@

# Count words.
.PHONY : dats
dats : $(DAT_FILES)

%.dat : $(COUNT_SRC) books/%.txt
	$(LANGUAGE) $^ $@

.PHONY : clean
clean :
	rm -f $(DAT_FILES)
	rm -f results.txt

.PHONY : variables
variables:
	@echo TXT_FILES: $(TXT_FILES)
	@echo DAT_FILES: $(DAT_FILES)</code></pre>
<p>Remember, the <code>config.mk</code> file contains:</p>
<pre class="make"><code><span><span class="co"># Count words script.</span></span>
<span><span class="va">LANGUAGE</span><span class="op">=</span><span class="va">python</span></span>
<span><span class="va">COUNT_SRC</span><span class="op">=</span><span class="va">countwords.py</span></span>
<span></span>
<span><span class="co"># Test Zipf's rule</span></span>
<span><span class="va">ZIPF_SRC</span><span class="op">=</span><span class="va">testzipf.py</span></span></code></pre>
<p>The following figure shows the dependencies embodied within our
Makefile, involved in building the <code>results.txt</code> target, now
we have introduced our function:</p>
<figure><img src="../fig/07-functions.png" title="results.txt dependencies after introducing a function" alt="results.txt dependencies after introducing a function" class="figure mx-auto d-block"></figure><div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are<a class="anchor" aria-label="anchor" href="#where-we-are"></a>
</h3>
<div class="callout-content">
<p><a href="../files/code/07-functions/Makefile">This Makefile</a> and <a href="../files/code/07-functions/config.mk">its accompanying
<code>config.mk</code></a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="adding-more-books" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="adding-more-books" class="callout-inner">
<h3 class="callout-title">Adding more books<a class="anchor" aria-label="anchor" href="#adding-more-books"></a>
</h3>
<div class="callout-content">
<p>We can now do a better job at testing Zipf’s rule by adding more
books. The books we have used come from the <a href="https://www.gutenberg.org/" class="external-link">Project Gutenberg</a> website. Project
Gutenberg offers thousands of free ebooks to download.</p>
<p><strong>Exercise instructions:</strong></p>
<ul>
<li>go to <a href="https://www.gutenberg.org/" class="external-link">Project Gutenberg</a> and
use the search box to find another book, for example <a href="https://www.gutenberg.org/ebooks/174" class="external-link">‘The Picture of Dorian
Gray’</a> from Oscar Wilde.</li>
<li>download the ‘Plain Text UTF-8’ version and save it to the
<code>books</code> folder; choose a short name for the file
(<strong>that doesn’t include spaces</strong>) e.g. “dorian_gray.txt”
because the filename is going to be used in the <code>results.txt</code>
file</li>
<li>optionally, open the file in a text editor and remove extraneous
text at the beginning and end (look for the phrase
<code>END OF THE PROJECT GUTENBERG EBOOK [title]</code>)</li>
<li>run <code>make</code> and check that the correct commands are run,
given the dependency tree</li>
<li>check the results.txt file to see how this book compares to the
others</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Make is actually a small programming language with many built-in
functions.</li>
<li>Use <code>wildcard</code> function to get lists of files matching a
pattern.</li>
<li>Use <code>patsubst</code> function to rewrite file names.</li>
</ul>
</div>
</div>
</div></section><section id="aio-08-self-doc"><p>Content from <a href="08-self-doc.html">Self-Documenting Makefiles</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/08-self-doc.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How should I document a Makefile?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write self-documenting Makefiles with built-in help.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Many bash commands, and programs that people have written that can be
run from within bash, support a <code>--help</code> flag to display more
information on how to use the commands or programs. In this spirit, it
can be useful, both for ourselves and for others, to provide a
<code>help</code> target in our Makefiles. This can provide a summary of
the names of the key targets and what they do, so we don’t need to look
at the Makefile itself unless we want to. For our Makefile, running a
<code>help</code> target might print:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> make help</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>results.txt : Generate Zipf summary table.
dats        : Count words in text files.
clean       : Remove auto-generated files.</code></pre>
</div>
<p>So, how would we implement this? We could write a rule like:</p>
<pre class="make"><code>.PHONY : help
help :
	@echo "results.txt : Generate Zipf summary table."
	@echo "dats        : Count words in text files."
	@echo "clean       : Remove auto-generated files."</code></pre>
<p>But every time we add or remove a rule, or change the description of
a rule, we would have to update this rule too. It would be better if we
could keep the descriptions of the rules by the rules themselves and
extract these descriptions automatically.</p>
<p>The bash shell can help us here. It provides a command called <a href="https://www.gnu.org/software/sed/" class="external-link">sed</a> which stands for
‘stream editor’. <code>sed</code> reads in some text, does some
filtering, and writes out the filtered text.</p>
<p>So, we could write comments for our rules, and mark them up in a way
which <code>sed</code> can detect. Since Make uses <code>#</code> for
comments, we can use <code>##</code> for comments that describe what a
rule does and that we want <code>sed</code> to detect. For example:</p>
<pre class="make"><code>## results.txt : Generate Zipf summary table.
results.txt : $(ZIPF_SRC) $(DAT_FILES)
	$(LANGUAGE) $^ &gt; $@

## dats        : Count words in text files.
.PHONY : dats
dats : $(DAT_FILES)

%.dat : $(COUNT_SRC) books/%.txt
	$(LANGUAGE) $^ $@

## clean       : Remove auto-generated files.
.PHONY : clean
clean :
	rm -f $(DAT_FILES)
	rm -f results.txt

## variables   : Print variables.
.PHONY : variables
variables:
	@echo TXT_FILES: $(TXT_FILES)
	@echo DAT_FILES: $(DAT_FILES)</code></pre>
<p>We use <code>##</code> so we can distinguish between comments that we
want <code>sed</code> to automatically filter, and other comments that
may describe what other rules do, or that describe variables.</p>
<p>We can then write a <code>help</code> target that applies
<code>sed</code> to our <code>Makefile</code>:</p>
<pre class="make"><code>.PHONY : help
help : Makefile
	@sed -n 's/^##//p' $&lt;</code></pre>
<p>This rule depends upon the Makefile itself. It runs <code>sed</code>
on the first dependency of the rule, which is our Makefile, and tells
<code>sed</code> to get all the lines that begin with <code>##</code>,
which <code>sed</code> then prints for us.</p>
<p>If we now run</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> make help</span></code></pre>
</div>
<p>we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> results.txt : Generate Zipf summary table.
 dats        : Count words in text files.
 clean       : Remove auto-generated files.
 variables   : Print variables.</code></pre>
</div>
<p>If we add, change or remove a target or rule, we now only need to
remember to add, update or remove a comment next to the rule. So long as
we respect our convention of using <code>##</code> for such comments,
then our <code>help</code> rule will take care of detecting these
comments and printing them for us.</p>
<div id="where-we-are" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="where-we-are" class="callout-inner">
<h3 class="callout-title">Where We Are<a class="anchor" aria-label="anchor" href="#where-we-are"></a>
</h3>
<div class="callout-content">
<p><a href="../files/code/08-self-doc/Makefile">This Makefile</a> and <a href="../files/code/08-self-doc/config.mk">its accompanying
<code>config.mk</code></a> contain all of our work so far.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Document Makefiles by adding specially-formatted comments and a
target to extract and format them.</li>
</ul>
</div>
</div>
</div></section><section id="aio-09-conclusion"><p>Content from <a href="09-conclusion.html">Conclusion</a></p>
<hr>
<p>Last updated on 2023-04-24 |

        <a href="https://github.com/swcarpentry/make-novice/edit/main/episodes/09-conclusion.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the advantages and disadvantages of using tools like
Make?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand advantages of automated build tools such as Make.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Automated build tools such as Make can help us in a number of ways.
They help us to automate repetitive commands, hence saving us time and
reducing the likelihood of errors compared with running these commands
manually.</p>
<p>They can also save time by ensuring that automatically-generated
artifacts (such as data files or plots) are only recreated when the
files that were used to create these have changed in some way.</p>
<p>Through their notion of targets, dependencies, and actions, they
serve as a form of documentation, recording dependencies between code,
scripts, tools, configurations, raw data, derived data, plots, and
papers.</p>
<div id="creating-pngs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-pngs" class="callout-inner">
<h3 class="callout-title">Creating PNGs<a class="anchor" aria-label="anchor" href="#creating-pngs"></a>
</h3>
<div class="callout-content">
<p>Add new rules, update existing rules, and add new variables to:</p>
<ul>
<li>Create <code>.png</code> files from <code>.dat</code> files using
<code>plotcounts.py</code>.</li>
<li>Remove all auto-generated files (<code>.dat</code>,
<code>.png</code>, <code>results.txt</code>).</li>
</ul>
<p>Finally, many Makefiles define a default <a href="reference.html#phony-target">phony target</a> called
<code>all</code> as first target, that will build what the Makefile has
been written to build (e.g. in our case, the <code>.png</code> files and
the <code>results.txt</code> file). As others may assume your Makefile
conforms to convention and supports an <code>all</code> target, add an
<code>all</code> target to your Makefile (Hint: this rule has the
<code>results.txt</code> file and the <code>.png</code> files as
dependencies, but no actions). With that in place, instead of running
<code>make results.txt</code>, you should now run <code>make all</code>,
or just simply <code>make</code>. By default, <code>make</code> runs the
first target it finds in the Makefile, in this case your new
<code>all</code> target.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><a href="../files/code/09-conclusion-challenge-1/Makefile">This
Makefile</a> and <a href="../files/code/09-conclusion-challenge-1/config.mk">this
<code>config.mk</code></a> contain a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<p>The following figure shows the dependencies involved in building the
<code>all</code> target, once we’ve added support for images:</p>
<figure><img src="../fig/09-conclusion-challenge-1.png" title="results.txt dependencies once images have been added" alt="results.txt dependencies once images have been added" class="figure mx-auto d-block"></figure><div id="creating-an-archive" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-an-archive" class="callout-inner">
<h3 class="callout-title">Creating an Archive<a class="anchor" aria-label="anchor" href="#creating-an-archive"></a>
</h3>
<div class="callout-content">
<p>Often it is useful to create an archive file of your project that
includes all data, code and results. An archive file can package many
files into a single file that can easily be downloaded and shared with
collaborators. We can add steps to create the archive file inside the
Makefile itself so it’s easy to update our archive file as the project
changes.</p>
<p>Edit the Makefile to create an archive file of your project. Add new
rules, update existing rules and add new variables to:</p>
<ul>
<li><p>Create a new directory called <code>zipf_analysis</code> in the
project directory.</p></li>
<li>
<p>Copy all our code, data, plots, the Zipf summary table, the
Makefile and config.mk to this directory. The <code>cp -r</code> command
can be used to copy files and directories into the new
<code>zipf_analysis</code> directory:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> cp <span class="at">-r</span> [files and directories to copy] zipf_analysis/</span></code></pre>
</div>
</li>
<li><p>Hint: create a new variable for the <code>books</code> directory
so that it can be copied to the new <code>zipf_analysis</code>
directory</p></li>
<li>
<p>Create an archive, <code>zipf_analysis.tar.gz</code>, of this
directory. The bash command <code>tar</code> can be used, as
follows:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> tar <span class="at">-czf</span> zipf_analysis.tar.gz zipf_analysis</span></code></pre>
</div>
</li>
<li><p>Update the target <code>all</code> so that it creates
<code>zipf_analysis.tar.gz</code>.</p></li>
<li><p>Remove <code>zipf_analysis.tar.gz</code> when
<code>make clean</code> is called.</p></li>
<li><p>Print the values of any additional variables you have defined
when <code>make variables</code> is called.</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p><a href="../files/code/09-conclusion-challenge-2/Makefile">This
Makefile</a> and <a href="../files/code/09-conclusion-challenge-2/config.mk">this
<code>config.mk</code></a> contain a solution to this challenge.</p>
</div>
</div>
</div>
</div>
<div id="archiving-the-makefile" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="archiving-the-makefile" class="callout-inner">
<h3 class="callout-title">Archiving the Makefile<a class="anchor" aria-label="anchor" href="#archiving-the-makefile"></a>
</h3>
<div class="callout-content">
<p>Why does the Makefile rule for the archive directory add the Makefile
to our archive of code, data, plots and Zipf summary table?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Our code files (<code>countwords.py</code>,
<code>plotcounts.py</code>, <code>testzipf.py</code>) implement the
individual parts of our workflow. They allow us to create
<code>.dat</code> files from <code>.txt</code> files, and
<code>results.txt</code> and <code>.png</code> files from
<code>.dat</code> files. Our Makefile, however, documents dependencies
between our code, raw data, derived data, and plots, as well as
implementing our workflow as a whole. <code>config.mk</code> contains
configuration information for our Makefile, so it must be archived
too.</p>
</div>
</div>
</div>
</div>
<div id="touch-the-archive-directory" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="touch-the-archive-directory" class="callout-inner">
<h3 class="callout-title">
<code>touch</code> the Archive Directory<a class="anchor" aria-label="anchor" href="#touch-the-archive-directory"></a>
</h3>
<div class="callout-content">
<p>Why does the Makefile rule for the archive directory
<code>touch</code> the archive directory after moving our code, data,
plots and summary table into it?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>A directory’s timestamp is not automatically updated when files are
copied into it. If the code, data, plots, and summary table are updated
and copied into the archive directory, the archive directory’s timestamp
must be updated with <code>touch</code> so that the rule that makes
<code>zipf_analysis.tar.gz</code> knows to run again; without this
<code>touch</code>, <code>zipf_analysis.tar.gz</code> will only be
created the first time the rule is run and will not be updated on
subsequent runs even if the contents of the archive directory have
changed.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Makefiles save time by automating repetitive work, and save thinking
by documenting how to reproduce results.</li>
</ul>
</div>
</div>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/swcarpentry/make-novice/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/swcarpentry/make-novice/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/swcarpentry/make-novice/" class="external-link">Source</a></p>
				<p><a href="https://github.com/swcarpentry/make-novice/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://swcarpentry.github.io/make-novice/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://swcarpentry.github.io/make-novice/instructor/aio.html",
  "identifier": "https://swcarpentry.github.io/make-novice/instructor/aio.html",
  "dateCreated": "2015-06-18",
  "dateModified": "2024-08-20",
  "datePublished": "2024-08-20"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

